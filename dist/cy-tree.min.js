"use strict";!function(a){var b=a.module("cyTree",[]);b.service("cyTreeUtils",[function(){function a(b,c,d,e,f){var g,h,i=b&&b.length;if(i&&e)for(;i--;){if(h=b[i],g=h[c],e(h,d,g),f&&f(h,d,g))return;a(g,c,h,e)}}function b(a,c,d,e){if(a&&d){var f=a[c];d(f,a),e&&e(f,a)||f&&b(f,c,d)}}var c=0,d="cyTree",e={},f=function(a,b,c){return"<ul><li ng-class=\"{'last-node': $last, 'has-child': node."+b+'.length}" ng-repeat="node in '+a+'"><i class="tree-icon css-icon" ng-if="node.'+b+'.length" ng-click="treeMethods.collapseNode(node)" ng-class="{\'icon-triangle-right-small\': node.collapsed, \'icon-triangle-bottom-small\': !node.collapsed}"></i><i class="tree-icon css-icon icon-space" ng-if="!node.'+b+'.length"></i><i class="tree-icon css-icon" ng-class="{\'icon-box\': node.nonSelected, \'icon-success\': node.selected, \'icon-box2\': node.partSelected}" ng-click="treeMethods.selectNode(node)"></i><span class="tree-label">{{node.'+c+'}}</span><div class="cy-sub-tree" ng-if="node.'+b+'.length" ng-hide="node.collapsed" tree-data="node.'+b+'"></div></li></ul>'};this.genTemplate=f,this.setTemplateGenerator=function(a){this.genTemplate=a},this.genUniqueId=function(){return d+ ++c},this.getTreeCount=function(){return c},this.iterateDown=a,this.iterateUp=b,this.templateCache=function(a,b){return"string"!=typeof b?e[a]:void(e[a]=b)}}]),b.directive("cyTree",["$log","$compile","cyTreeUtils",function(a,b,c){return{restrict:"A",scope:!0,priority:1,compile:function(b,d){function e(a,b,c,d){return a.leafNode?void(void 0!==d?(a.selected=d,a.nonSelected=!d):(a.selected=!!a.selected,a.nonSelected=!a.selected)):(a.selected=!1,a.partSelected=!1,a.nonSelected=!1,void(0===b?a.nonSelected=!0:c>b?a.partSelected=!0:a.selected=!0))}var f=d.treeData,g=d.treeChildFlag||"list",h=d.treeLabelFlag||"name",i=d.debugMode,j=function(){i&&a.debug&&a.debug.apply(this,arguments)},k=c.genUniqueId(),l=c.genTemplate("node."+g,g,h);return c.templateCache(k,l),j("set tpl",k),{pre:function(a){var b,d=a.treeMethods={},h=a.treeInfo={},i=!1;a.treeInfo.treeId=k,i||(b=a.$watch(f,function(d){void 0!==d&&(console.log("cyTree:handle raw data",d),b(),c.iterateDown(a[f],g,null,function(a,b,c){var d,f=0,g=0;if(a.parent=b,c&&c.length){for(f=d=c.length;d--;)c[d].selected&&g++;a.selectedCount=g}else a.selectedCount=0,a.leafNode=!0;e(a,g,f),a.collapsed=!!a.collapsed}))})),d.collapseNode=function(a){j("cyTree:collapseNode",k),a.collapsed=!a.collapsed,h.currentCollapsedNode=a},d.selectNode=function(a){if(a){j("cyTree:selectNode",k);var b=a.nonSelected,d=!1;b?(a.selected=!0,a.nonSelected=a.partSelected=!1,d=!0):(a.nonSelected=!0,a.selected=a.partSelected=!1),h.currentSelectedNode=a,c.iterateUp(a,"parent",function(a){a&&(d?a.selectedCount++:a.selectedCount--,e(a,a.selectedCount,a[g].length))},function(a){return a?a.partSelected&&a.selectedCount>(d?1:0):!0}),a.leafNode||c.iterateDown([a],g,null,function(b,c,f){var g=0;a!==b&&(d?f&&(g=b.selectedCount=f.length):b.selectedCount=0,e(b,b.selectedCount,g,d))})}}}}}}}]),b.directive("treeData",["$q","$log","$compile","cyTreeUtils",function(a,b,c,d){var e=!1;return{restrict:"A",scope:!0,link:function(a,b,f){var g=e?d.templateCache(a.treeInfo.treeId):d.genTemplate(f.treeData,f.treeChildFlag||"list",f.treeLabelFlag||"name");e=!0,b.append(c(g)(a))}}}])}(angular);