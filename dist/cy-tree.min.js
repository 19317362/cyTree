"use strict";!function(a){var b=a.module("cyTree",[]);b.service("cyTreeUtils",[function(){function a(b,c,d,e,f){var g,h,i=b&&b.length;if(i&&e)for(;i--;){if(h=b[i],g=h[c],e(h,d,g),f&&f(h,d,g))return;a(g,c,h,e)}}function b(a,c,d,e){if(a&&d){var f=a[c];d(f,a),e&&e(f,a)||f&&b(f,c,d)}}function c(a,b,d){if(a&&a[b])for(var e,f=a[b],g=f.length;g--;)e=f[g],d&&d(e),c(e)}var d=0,e="cyTree",f=function(a,b,c){return"<ul><li ng-class=\"{'last-node': $last, 'has-child': node."+b+'.length}" ng-repeat="node in '+a+'"><i class="tree-icon css-icon" ng-if="node.'+b+'.length" ng-click="treeMethods.collapseNode(node)" ng-class="{\'icon-triangle-right-small\': node.collapsed, \'icon-triangle-bottom-small\': !node.collapsed}"></i><i class="tree-icon css-icon icon-space" ng-if="!node.'+b+'.length"></i><i class="tree-icon css-icon" ng-class="{\'icon-box\': node.nonSelected, \'icon-success\': node.selected, \'icon-box2\': node.partSelected}" ng-click="treeMethods.selectNode(node)"></i><span class="tree-label">{{node.'+c+'}}</span><div class="cy-sub-tree" ng-if="node.'+b+'.length" ng-hide="node.collapsed" tree-data="node.'+b+'" tree-label-flag="'+c+'" tree-child-flag="'+b+'"></div></li></ul>'};this.genTemplate=f,this.setTemplateGenerator=function(a){this.genTemplate=a},this.genUniqueId=function(){return e+ ++d},this.getTreeCount=function(){return d},this.iterateDown=a,this.iterateUp=b,this.formatData=function(a,b,d,e,f){if(!a||!a.length)return[];var g,h=a.length,i={};for(f=f||function(){};h--;){var j=a[h],k=j[d];f(j),k===b&&(g=j),i[k]||(i[k]=[]),i[k].push(j)}return g.list=i[b],c(g,"list",function(a){a.list=i[a[e]]}),[g]},this.iterate=c}]),b.controller("cyTreeController",function(a,b,c){function d(a,b,c,d){return a.leafNode?void(void 0!==d?(a.selected=d,a.nonSelected=!d):(a.selected=!!a.selected,a.nonSelected=!a.selected)):(a.selected=!1,a.partSelected=!1,a.nonSelected=!1,void(0===b?a.nonSelected=!0:c>b?a.partSelected=!0:a.selected=!0))}var e,f,g,h,i,j=this;a.$handling=!0,e=a.treeMethods={},f=a.treeId=c.genUniqueId(),g=a[f]={},this.init=function(e,f,g,k,l){i=function(){l&&b.debug&&b.debug.apply(this,arguments)},i("cyTree:about to init, treeData is",e),j.template=c.genTemplate(e,f,g),k||(h=a.$watch(e,function(b){void 0!==b&&(i("cyTree:handle raw data",b),h(),c.iterateDown(a[e],f,null,function(a,b,c){var e,f=0,g=0;if(a.parent=b,c&&c.length){for(f=e=c.length;e--;)c[e].selected&&g++;a.selectedCount=g}else a.selectedCount=0,a.leafNode=!0;d(a,g,f),a.collapsed=!!a.collapsed}))}))},e.collapseNode=function(a){i("cyTree:collapseNode",f),a.collapsed=!a.collapsed,g.currentCollapsedNode=a},e.selectNode=function(a){if(a){i("cyTree:selectNode",f);var b=a.nonSelected,e=!1;b?(a.selected=!0,a.nonSelected=a.partSelected=!1,e=!0):(a.nonSelected=!0,a.selected=a.partSelected=!1),g.currentSelectedNode=a,c.iterateUp(a,"parent",function(a){a&&(e?a.selectedCount++:a.selectedCount--,d(a,a.selectedCount,a[treeChildFlag].length))},function(a){return a?a.partSelected&&a.selectedCount>(e?1:0):!0}),a.leafNode||c.iterateDown([a],treeChildFlag,null,function(b,c,f){var g=0;a!==b&&(e?f&&(g=b.selectedCount=f.length):b.selectedCount=0,d(b,b.selectedCount,g,e))})}}}),b.directive("cyTree",["$q","$log","$compile","cyTreeUtils",function(a,b,c){return{restrict:"A",scope:!0,controller:"cyTreeController",link:function(a,b,d,e){var f=d.treeData,g=d.treeChildFlag||"list",h=d.treeLabelFlag||"name",i=!1;e.init(f,g,h,i,d.debugMode),b.html("").append(c(e.template)(a))}}}]),b.directive("treeData",["$compile",function(a){return{restrict:"A",scope:!0,require:"^cyTree",link:function(b,c,d,e){console.log("-----"),c.html("").append(a(e.template)(b))}}}])}(angular);