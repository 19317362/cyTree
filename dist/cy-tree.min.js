"use strict";!function(a){var b=a.module("cyTree",[]);b.service("cyTreeUtils",[function(){function a(b,c,d,e,f){var g,h,i=b&&b.length;if(i&&e)for(;i--;){if(h=b[i],g=h[c],e(h,d,g),f&&f(h,d,g))return;a(g,c,h,e)}}function b(a,c,d,e){if(a&&d){var f=a[c];d(f,a),e&&e(f,a)||f&&b(f,c,d)}}function c(a,b,d){if(a&&a[b])for(var e,f=a[b],g=f.length;g--;)e=f[g],d&&d(e),c(e)}var d=0,e="cyTree",f=function(a,b,c){return"<ul><li ng-class=\"{'last-node': $last, 'has-child': node."+b+'.length}" ng-repeat="node in '+a+'"><i class="tree-icon css-icon" ng-if="node.'+b+'.length" ng-click="treeMethods.collapseNode(node)" ng-class="{\'icon-triangle-right-small\': node.collapsed, \'icon-triangle-bottom-small\': !node.collapsed}"></i><i class="tree-icon css-icon icon-space" ng-if="!node.'+b+'.length"></i><i class="tree-icon css-icon" ng-class="{\'icon-box\': node.nonSelected, \'icon-success\': node.selected, \'icon-box2\': node.partSelected}" ng-click="treeMethods.selectNode(node)"></i><span class="tree-label">{{node.'+c+'}}</span><div class="cy-sub-tree" ng-if="node.'+b+'.length" ng-hide="node.collapsed" tree-data="node.'+b+'"></div></li></ul>'};this.genTemplate=f,this.setTemplateGenerator=function(a){this.genTemplate=a},this.genUniqueId=function(){return e+ ++d},this.getTreeCount=function(){return d},this.iterateDown=a,this.iterateUp=b,this.formatData=function(a,b,d,e,f){if(!a||!a.length)return[];var g,h=a.length,i={};for(f=f||function(){};h--;){var j=a[h],k=j[d];f(j),k===b&&(g=j),i[k]||(i[k]=[]),i[k].push(j)}return g.list=i[b],c(g,"list",function(a){a.list=i[a[e]]}),[g]},this.iterate=c}]),b.controller("cyTreeController",function(a,b,c,d){function e(a,b,c,d){return a.leafNode?void(void 0!==d?(a.selected=d,a.nonSelected=!d):(a.selected=!!a.selected,a.nonSelected=!a.selected)):(a.selected=!1,a.partSelected=!1,a.nonSelected=!1,void(0===b?a.nonSelected=!0:c>b?a.partSelected=!0:a.selected=!0))}var f,g,h,i,j,k=this,l=b.defer();a.$handling=!0,f=a.treeMethods={},g=a.treeId=d.genUniqueId(),h=a[g]={},this.$initPromise=l.promise,this.init=function(b,f,g,h,m){j=function(){m&&c.debug&&c.debug.apply(this,arguments)},j("cyTree:about to init, treeData is",b),k.template=d.genTemplate(b,f,g),l.resolve(k.template),h||(i=a.$watch(b,function(c){void 0!==c&&(j("cyTree:handle raw data",c),i(),d.iterateDown(a[b],f,null,function(a,b,c){var d,f=0,g=0;if(a.parent=b,c&&c.length){for(f=d=c.length;d--;)c[d].selected&&g++;a.selectedCount=g}else a.selectedCount=0,a.leafNode=!0;e(a,g,f),a.collapsed=!!a.collapsed}))}))},f.collapseNode=function(a){j("cyTree:collapseNode",g),a.collapsed=!a.collapsed,h.currentCollapsedNode=a},f.selectNode=function(a){if(a){j("cyTree:selectNode",g);var b=a.nonSelected,c=!1;b?(a.selected=!0,a.nonSelected=a.partSelected=!1,c=!0):(a.nonSelected=!0,a.selected=a.partSelected=!1),h.currentSelectedNode=a,d.iterateUp(a,"parent",function(a){a&&(c?a.selectedCount++:a.selectedCount--,e(a,a.selectedCount,a[treeChildFlag].length))},function(a){return a?a.partSelected&&a.selectedCount>(c?1:0):!0}),a.leafNode||d.iterateDown([a],treeChildFlag,null,function(b,d,f){var g=0;a!==b&&(c?f&&(g=b.selectedCount=f.length):b.selectedCount=0,e(b,b.selectedCount,g,c))})}}}),b.directive("cyTree",["$q","$compile",function(){return{restrict:"A",scope:!0,priority:1,controller:"cyTreeController",link:function(a,b,c,d){var e=c.treeData,f=c.treeChildFlag||"list",g=c.treeLabelFlag||"name",h=!1;d.init(e,f,g,h,c.debugMode)}}}]),b.directive("treeData",["$compile",function(a){return{restrict:"A",scope:!0,priority:0,require:"?^cyTree",link:function(b,c,d,e){console.log("-----",e),e&&(e.$initPromise.then(function(a){console.log(a)}),console.log(b,c,d,e.template,a(e.template)(b)))}}}])}(angular);